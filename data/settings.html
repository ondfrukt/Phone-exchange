<!doctype html>
<html lang="sv">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PhoneExchange - Settings & Debug</title>

  <!-- Länk till extern CSS -->
  <link rel="stylesheet" href="style.css">

  <!-- Länk till extern JS -->
  <script src="settings.js" defer></script>
</head>
<body class="settings-page">
  <main class="wrap">
    <div class="page-header">
      <h1>Settings & Debug</h1>
      <nav class="page-nav">
        <a href="index.html" class="nav-link">← Back to Dashboard</a>
      </nav>
    </div>

    <!-- Ring Test Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Ring Test</h2>
      <p class="description">Test the ring function on a specific phone line</p>
      <div class="ring-test-controls">
        <label for="ring-line-select">Select Line:</label>
        <select id="ring-line-select" class="form-select">
          <option value="">-- No active lines --</option>
        </select>
        <button id="ring-test-btn" class="badge clickable" disabled>Test Ring</button>
        <button id="ring-stop-btn" class="badge clickable" disabled>Stop Ring</button>
      </div>
      <div id="ring-status" class="status"></div>
    </section>

    <!-- Debug Levels Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Debug Levels</h2>
      
      <div class="row">
        <span class="k">SHKService</span>
        <span class="v">
          <select id="dbg-shk" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">LineManager</span>
        <span class="v">
          <select id="dbg-lm" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">WebServer</span>
        <span class="v">
          <select id="dbg-ws" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">LineAction</span>
        <span class="v">
          <select id="dbg-la" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">MT8816Driver</span>
        <span class="v">
          <select id="dbg-mt" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">ToneReader</span>
        <span class="v">
          <select id="dbg-tr" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">ToneGenerator</span>
        <span class="v">
          <select id="dbg-tg" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">RingGenerator</span>
        <span class="v">
          <select id="dbg-rg" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">MCPDriver</span>
        <span class="v">
          <select id="dbg-mcp" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">I2C</span>
        <span class="v">
          <select id="dbg-i2c" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">InterruptManager</span>
        <span class="v">
          <select id="dbg-im" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Tone generator enabled</span>
        <span class="v">
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="checkbox" id="tone-enabled" />
            <span id="tone-enabled-label">Unknown</span>
          </label>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">LineAudioConnections</span>
        <span class="v">
          <select id="dbg-lac" class="form-select">
            <option value="0">0 – Off</option>
            <option value="1">1 – Low</option>
            <option value="2">2 – High</option>
          </select>
        </span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="dbg-save" class="badge clickable" style="border:1px solid var(--accent)">
          Update
        </button>
        <div id="dbg-status" class="status"></div>
      </div>
    </section>

    <!-- Ring Settings Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Ring Settings</h2>
      
      <div class="row">
        <span class="k">Ring Length (s)</span>
        <span class="v">
          <input type="number" id="ring-length" class="form-input" min="0.1" max="10" step="0.1" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Ring Pause (s)</span>
        <span class="v">
          <input type="number" id="ring-pause" class="form-input" min="0.1" max="10" step="0.1" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Ring Iterations</span>
        <span class="v">
          <input type="number" id="ring-iterations" class="form-input" min="1" max="10" step="1" />
        </span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="ring-save" class="badge clickable" style="border:1px solid var(--accent)">
          Update
        </button>
        <div id="ring-settings-status" class="status"></div>
      </div>
    </section>

    <!-- SHK/Ring Detection Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Hook Detection & Burst</h2>
      <p class="description">Tune SHK sampling during ringing/off-hook detection</p>

      <div class="row">
        <span class="k">Burst Tick (s)</span>
        <span class="v">
          <input type="number" id="burst-tick-ms" class="form-input" min="0.001" max="0.1" step="0.001" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Hook Stable Time (s)</span>
        <span class="v">
          <input type="number" id="hook-stable-ms" class="form-input" min="0.01" max="2" step="0.01" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Hook Stable Consec</span>
        <span class="v">
          <input type="number" id="hook-stable-consec" class="form-input" min="0" max="100" step="1" />
        </span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="shk-save" class="badge clickable" style="border:1px solid var(--accent)">
          Update
        </button>
        <div id="shk-settings-status" class="status"></div>
      </div>
    </section>

    <!-- ToneReader Settings Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">ToneReader Settings</h2>
      <p class="description">Tune DTMF detection and TMUX scanning sensitivity</p>

      <div class="row">
        <span class="k">DTMF Debounce (ms)</span>
        <span class="v">
          <input type="number" id="dtmf-debounce-ms" class="form-input" min="20" max="1000" step="1" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">DTMF Min Tone (ms)</span>
        <span class="v">
          <input type="number" id="dtmf-min-tone-ms" class="form-input" min="10" max="200" step="1" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">DTMF STD Stable (ms)</span>
        <span class="v">
          <input type="number" id="dtmf-std-stable-ms" class="form-input" min="1" max="100" step="1" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">TMUX Dwell Min (ms)</span>
        <span class="v">
          <input type="number" id="tmux-scan-dwell-min-ms" class="form-input" min="1" max="500" step="1" />
        </span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="tonereader-save" class="badge clickable" style="border:1px solid var(--accent)">
          Update
        </button>
        <div id="tonereader-status" class="status"></div>
      </div>
    </section>

    <!-- Timer Settings Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Timer Settings</h2>
      
      <div class="row">
        <span class="k">Ready Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-ready" class="form-input" min="1" max="600" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Dialing Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-dialing" class="form-input" min="1" max="60" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Ringing Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-ringing" class="form-input" min="1" max="60" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Pulse Dialing Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-pulse-dialing" class="form-input" min="1" max="60" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Tone Dialing Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-tone-dialing" class="form-input" min="1" max="60" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Fail Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-fail" class="form-input" min="1" max="120" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Disconnected Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-disconnected" class="form-input" min="1" max="120" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Timeout Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-timeout" class="form-input" min="1" max="120" step="0.5" />
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Busy Timer (s)</span>
        <span class="v">
          <input type="number" id="timer-busy" class="form-input" min="1" max="120" step="0.5" />
        </span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="timer-save" class="badge clickable" style="border:1px solid var(--accent)">
          Update
        </button>
        <div id="timer-status" class="status"></div>
      </div>
    </section>

    <!-- MQTT Settings Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">MQTT Settings</h2>
      <p class="description">Configure broker connection and topic settings</p>

      <div class="row">
        <span class="k">Enable MQTT</span>
        <span class="v">
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="checkbox" id="mqtt-enabled" />
            <span id="mqtt-enabled-label">Disabled</span>
          </label>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Broker Host</span>
        <span class="v"><input type="text" id="mqtt-host" class="form-input" maxlength="128" /></span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Broker Port</span>
        <span class="v"><input type="number" id="mqtt-port" class="form-input" min="1" max="65535" step="1" /></span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Username</span>
        <span class="v"><input type="text" id="mqtt-username" class="form-input" maxlength="64" /></span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Password</span>
        <span class="v"><input type="password" id="mqtt-password" class="form-input" maxlength="64" /></span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Client ID</span>
        <span class="v"><input type="text" id="mqtt-client-id" class="form-input" maxlength="64" /></span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Base Topic</span>
        <span class="v"><input type="text" id="mqtt-base-topic" class="form-input" maxlength="128" /></span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">QoS</span>
        <span class="v">
          <select id="mqtt-qos" class="form-select">
            <option value="0">0</option>
            <option value="1">1</option>
            <option value="2">2</option>
          </select>
        </span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">Retain state</span>
        <span class="v">
          <label style="display:flex; align-items:center; gap:6px;">
            <input type="checkbox" id="mqtt-retain" />
            <span id="mqtt-retain-label">On</span>
          </label>
        </span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px">
        <button id="mqtt-save" class="badge clickable" style="border:1px solid var(--accent)">
          Update
        </button>
        <div id="mqtt-status" class="status"></div>
      </div>
    </section>

    <!-- Device Control Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Device Control</h2>
      <p class="description">Device info and recovery actions</p>

      <div class="row">
        <span class="k">Hostname</span>
        <span class="v" id="dev-hostname">-</span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">MAC Address</span>
        <span class="v" id="dev-mac">-</span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">IP Address</span>
        <span class="v" id="dev-ip">-</span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">WiFi Network (SSID)</span>
        <span class="v" id="dev-ssid">-</span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">WiFi Status</span>
        <span class="v" id="dev-wifi-status">-</span>
        <span></span>
      </div>

      <div class="row">
        <span class="k">MQTT Enabled</span>
        <span class="v" id="dev-mqtt-status">-</span>
        <span></span>
      </div>

      <div style="display:flex; gap:10px; margin-top:10px; flex-wrap:wrap;">
        <button id="wifi-change-btn" class="badge clickable" style="border:1px solid var(--accent)">
          Change WiFi Settings
        </button>
        <button id="factory-reset-btn" class="badge clickable" style="border:1px solid var(--no)">
          Factory Reset
        </button>
        <button id="dbg-restart" class="badge clickable" style="border:1px solid var(--no)">
          Restart Device
        </button>
      </div>
      <div id="device-status" class="status"></div>
    </section>

    <!-- Console Section -->
    <section class="card">
      <h2 style="margin:0 0 12px; font-size:1.2rem">Console</h2>
      <p class="description">System log messages</p>
      <pre id="console-log" class="console-log" aria-live="polite" role="log"></pre>
    </section>
  </main>
</body>
</html>
